{

  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",

  "contentVersion": "1.0.0.0",

  "parameters": {

   "policyName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Backup Policy"
      }
    },

    "scheduleRunTimes": {
      "type": "array",
      "metadata": {
        "description": "Times in day when backup should be triggered. e.g. 01:00 or 13:00. Must be an array, however for IaaS VMs only one value is valid. This will be used in LTR too for daily, weekly, monthly and yearly backup."
      }
    },

    "timeZone": {
      "type": "string",
      "metadata": {
        "description": "Any Valid timezone, for example:UTC, Pacific Standard Time. Refer: https://msdn.microsoft.com/en-us/library/gg154758.aspx"
      }
    },

    "instantRpRetentionRangeInDays": {
      "type": "int",
      "defaultValue": 2,
      "allowedValues": [
        1,
        2,
        3,
        4,
        5
      ],

      "metadata": {
        "description": "Number of days Instant Recovery Point should be retained"
      }
    },

    "dailyRetentionDurationCount": {
      "type": "int",
      "metadata": {
        "description": "Number of days you want to retain the backup"
      }
    }
  },
  "variables": {
    //Recovery Vault properties
    "recoveryVaultName":  "bcprdrsvbaca001pmp1234"
  },

    "resources": [
      {
        "type": "Microsoft.RecoveryServices/vaults",
        "apiVersion": "2016-06-01",
        "name": "[variables('recoveryVaultName')]",
        "location": "[resourceGroup().location]",
        "tags": {
          "Environment": "Production",
          "Application": "Azure Backup",
          "Function": "Storage",
          "Application Owner": "Tim Farrance",
          "Directorate": "Policy, Strategy and ICT",
          "Cost Centre": "11302"
        },
        "sku": {
          "name": "RS0",
          "tier": "Standard"
        },
        "properties": {}
      },
      {
        "apiVersion": "2016-06-01",
        "name": "[concat(variables('recoveryVaultName'), '/', parameters('policyName'))]",
        "type": "Microsoft.RecoveryServices/vaults/backupPolicies",
        "dependsOn": [
          "[concat('Microsoft.RecoveryServices/vaults/', variables('recoveryVaultName'))]"
        ],

        "location": "[resourceGroup().location]",
        "tags": {
          "Environment": "Production",
          "Application": "Azure Backup",
          "Function": "Storage",
          "Application Owner": "Tim Farrance",
          "Directorate": "Policy, Strategy and ICT",
          "Cost Centre": "11302"
        },

        "properties": {
          "backupManagementType": "AzureIaasVM",
          "instantRpRetentionRangeInDays": "[parameters('instantRpRetentionRangeInDays')]",
          "schedulePolicy": {
            "scheduleRunFrequency": "Daily",
            "scheduleRunDays": null,
            "scheduleRunTimes": "[parameters('scheduleRunTimes')]",
            "schedulePolicyType": "SimpleSchedulePolicy"
          },

          "retentionPolicy": {
            "dailySchedule": {
              "retentionTimes": "[parameters('scheduleRunTimes')]",
              "retentionDuration": {
                "count": "[parameters('dailyRetentionDurationCount')]",
                "durationType": "Days"
              }
            }
          }
        }
      }
    ]
}