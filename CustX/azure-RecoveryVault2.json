{
   "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
     "vaultName": {
       "type": "string",
       "metadata": {
         "description": "Name of the Vault"
       }
     },
     "vaultRG": {
       "type": "string",
       "metadata": {
         "description": "Name of the Resource Group"
       }
     },
     "skuTier": {
       "type": "string",
       "defaultValue": "Standard",
       "allowedValues": [
         "Standard"
       ],
       "metadata": {
         "description": "SKU tier for the vault"
       }
     },
     "location": {
       "type": "string",
       "defaultValue": "[resourceGroup().location]",
       "metadata": {
         "description": "Location for all resources."
       }
     },
     "vmBackupPolicyName": {
       "type": "string",
       "defaultValue": "HourlyLogBackup",
       "metadata": {
         "description": "Name of the SQL VM Backup Policy"
       }
     },    
     "scheduleRunTimes": {
       "type": "array",
       "metadata": {
         "description": "Times in day when backup should be triggered. e.g. 01:00 or 13:00. Must be an array, however for IaaS VMs only one value is valid. This will be used in LTR too for daily, weekly, monthly and yearly backup."
       }
     },
     "timeZone": {
       "type": "string",
       "metadata": {
         "description": "Any Valid timezone, for example:UTC, Pacific Standard Time. Refer: https://msdn.microsoft.com/en-us/library/gg154758.aspx"
       }
     },
     "dailyRetentionDurationCount": {
       "type": "int",
       "metadata": {
         "description": "Number of days you want to retain the backup"
       }
     }
   },
   "resources": [
     {
       "type": "Microsoft.RecoveryServices/vaults",
       "apiVersion": "2018-01-10",
       "name": "[parameters('vaultName')]",
       "location": "[parameters('location')]",
       "sku": {
         "name": "RS0",
         "tier": "[parameters('skuTier')]"
       },
       "properties": {
     },
       "dependsOn": [
     ]
   },
     { 
       "name": "[concat(parameters('vaultName'), '/vaultstorageconfig')]", 
       "type": "Microsoft.RecoveryServices/vaults/backupstorageconfig", 
       "apiVersion": "2016-12-01", 
       "location": "[parameters('location')]", 
       "properties": { 
       "storageModelType": "LocallyRedundant", 
       "storageType": "LocallyRedundant", 
       "storageTypeState": "Unlocked" 
       }, 
       "dependsOn": [ 
       "[resourceId(parameters('vaultRG'), 'Microsoft.RecoveryServices/vaults', parameters('vaultName'))]"
     ] 
     },
     {
       "apiVersion": "2016-06-01",
       "name": "[concat(parameters('vaultName'), '/', parameters('vmBackupPolicyName'))]",
       "type": "Microsoft.RecoveryServices/vaults/backupPolicies",
       "dependsOn": [
         "[concat('Microsoft.RecoveryServices/vaults/', parameters('vaultName'))]"
       ],
       "location": "[parameters('location')]",
       "properties": {
         "backupManagementType": "AzureIaasVM",
         "schedulePolicy": {
           "scheduleRunFrequency": "Daily",
           "scheduleRunDays": null,
           "scheduleRunTimes": "[parameters('scheduleRunTimes')]",
           "schedulePolicyType": "SimpleSchedulePolicy"
         },
         "retentionPolicy": {
           "dailySchedule": {
             "retentionTimes": "[parameters('scheduleRunTimes')]",
             "retentionDuration": {
               "count": "[parameters('dailyRetentionDurationCount')]",
               "durationType": "Days"
             }
           },
           "retentionPolicyType": "LongTermRetentionPolicy"
         },
         "timeZone": "[parameters('timeZone')]"
         }
       }
   ]
 }